<!DOCTYPE html>
<html lang="en">
<head>
    <title>The Legendary Spell Forge</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(to bottom, #1e3c72, #2a5298);
            min-height: 100vh;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #1e3c72;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .status-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        .stat-card {
            background: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .story-text {
            font-size: 18px;
            line-height: 1.7;
            color: #2c3e50;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 5px solid #667eea;
        }

        .choices {
            margin: 20px 0;
        }

        button {
            display: block;
            width: 100%;
            padding: 0.8rem 1.5rem;
            margin: 10px 0;
            font-size: 1rem;
            background: white;
            color: #333;
            border: 2px solid #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        button:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        button:disabled {
            background: #ccc;
            border-color: #ccc;
            color: #666;
            cursor: not-allowed;
            transform: none;
        }

        .spells-panel {
            background: #e8f4fd;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 5px solid #3498db;
        }

        .spell {
            display: inline-block;
            background: white;
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .spell:hover {
            background: #3498db;
            color: white;
        }

        .system-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 0.9rem;
            color: #856404;
        }

        .shake {
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .popup {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
        }

        .popup.damage {
            background: #e74c3c;
        }

        .popup.healing {
            background: #2ecc71;
        }

        .popup.info {
            background: #3498db;
        }

        .popup.achievement {
            background: #f39c12;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            body {
                margin: 20px auto;
                padding: 10px;
            }

            .game-container {
                padding: 20px;
            }

            .status-panel {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üîÆ The Legendary Spell Forge</h1>

        <div class="status-panel">
            <div class="stat-card">
                <div class="stat-label">Health</div>
                <div class="stat-value" id="health">120</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Mana</div>
                <div class="stat-value" id="mana">100</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Gold</div>
                <div class="stat-value" id="gold">850</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Level</div>
                <div class="stat-value" id="level">5</div>
            </div>
        </div>

        <div class="spells-panel">
            <strong>üåü Known Spells:</strong>
            <div id="spellList">
                <span class="spell" onclick="castSpell('fireball')">üî• Fireball</span>
                <span class="spell" onclick="castSpell('heal')">üíö Heal</span>
                <span class="spell" onclick="castSpell('shield')">üõ°Ô∏è Magic Shield</span>
            </div>
        </div>

        <div id="story" class="story-text">
            After slaying the ancient dragon, you have gained legendary status and learned the location of the mythical Spell Forge! This ancient magical workshop contains the power to create ultimate spells and enchantments. But first, you must prove your mastery by completing three trials using your newfound object-oriented magical abilities.
        </div>

        <div id="choices" class="choices">
            <button onclick="enterTrialOfCombat()">‚öîÔ∏è Enter Trial of Combat</button>
            <button onclick="enterTrialOfCrafting()">üî® Enter Trial of Crafting</button>
            <button onclick="enterTrialOfWisdom()">üìö Enter Trial of Wisdom</button>
        </div>

        <div class="system-info">
            <strong>üéØ Programming Concepts Demonstrated:</strong>
            This quest showcases professional object-oriented programming:
            <br>‚Ä¢ Character object with methods for complex stat management and spell casting
            <br>‚Ä¢ Combat system with shake animations and visual effects from the slides
            <br>‚Ä¢ Spell objects with properties, casting methods, and cooldown systems
            <br>‚Ä¢ Equipment system with automatic stat bonuses and enhancement methods
        </div>
    </div>

    <script>
        // Character object - demonstrates complex object with methods and properties
        const character = {
            name: "Legendary Mage",
            health: 120,
            maxHealth: 120,
            mana: 100,
            maxMana: 100,
            gold: 850,
            level: 5,
            experience: 0,
            experienceToNext: 1000,

            // Equipment system - nested objects
            equipment: {
                weapon: { name: "Dragon Staff", attack: 25, manaBonus: 20 },
                armor: { name: "Archmage Robes", defense: 15, healthBonus: 20 },
                accessory: { name: "Ring of Power", critChance: 0.15, manaRegen: 5 }
            },

            // Method to safely modify stats
            modifyStats: function(changes) {
                if (changes.health !== undefined) {
                    const oldHealth = this.health;
                    this.health = Math.max(0, Math.min(this.maxHealth, this.health + changes.health));

                    if (changes.health < 0) {
                        effects.shake(document.querySelector('.status-panel'));
                        effects.popup(`-${Math.abs(changes.health)} HP`, 'damage');
                    } else if (changes.health > 0) {
                        effects.popup(`+${changes.health} HP`, 'healing');
                    }
                }

                if (changes.mana !== undefined) {
                    this.mana = Math.max(0, Math.min(this.maxMana, this.mana + changes.mana));
                    if (changes.mana < 0) {
                        effects.popup(`-${Math.abs(changes.mana)} MP`, 'info');
                    }
                }

                if (changes.gold !== undefined) {
                    this.gold = Math.max(0, this.gold + changes.gold);
                    if (changes.gold > 0) {
                        effects.popup(`+${changes.gold} Gold!`, 'achievement');
                    }
                }

                this.updateDisplay();
            },

            // Method to cast spells
            castSpell: function(spellName) {
                const spell = spellSystem.spells[spellName];
                if (!spell) return false;

                if (this.mana >= spell.manaCost) {
                    this.modifyStats({ mana: -spell.manaCost });
                    spell.cast();
                    effects.popup(`Cast ${spell.name}!`, 'info');
                    return true;
                } else {
                    effects.popup('Not enough mana!', 'damage');
                    return false;
                }
            },

            // Method to gain experience and level up
            gainExperience: function(amount) {
                this.experience += amount;
                effects.popup(`+${amount} XP`, 'achievement');

                if (this.experience >= this.experienceToNext) {
                    this.levelUp();
                }
            },

            // Method to level up
            levelUp: function() {
                this.level++;
                this.experience -= this.experienceToNext;
                this.experienceToNext = this.level * 1000;

                this.maxHealth += 20;
                this.maxMana += 15;
                this.health = this.maxHealth; // Full heal on level up
                this.mana = this.maxMana;

                effects.popup(`Level Up! Now level ${this.level}!`, 'achievement');
                this.updateDisplay();
            },

            // Method to update display
            updateDisplay: function() {
                document.getElementById('health').textContent = this.health;
                document.getElementById('mana').textContent = this.mana;
                document.getElementById('gold').textContent = this.gold;
                document.getElementById('level').textContent = this.level;
            }
        };

        // Spell system object - demonstrates object organization and methods
        const spellSystem = {
            spells: {
                fireball: {
                    name: "Fireball",
                    manaCost: 15,
                    damage: 35,
                    cast: function() {
                        const damage = this.damage + Math.floor(Math.random() * 10);
                        return damage;
                    }
                },
                heal: {
                    name: "Heal",
                    manaCost: 20,
                    healing: 40,
                    cast: function() {
                        const healing = this.healing + Math.floor(Math.random() * 15);
                        character.modifyStats({ health: healing });
                        return healing;
                    }
                },
                shield: {
                    name: "Magic Shield",
                    manaCost: 25,
                    protection: 25,
                    cast: function() {
                        character.shieldActive = this.protection;
                        setTimeout(() => { character.shieldActive = 0; }, 30000);
                        return this.protection;
                    }
                },
                lightning: {
                    name: "Lightning Bolt",
                    manaCost: 30,
                    damage: 50,
                    cast: function() {
                        const damage = this.damage + Math.floor(Math.random() * 20);
                        return damage;
                    }
                }
            },

            // Method to learn new spells
            learnSpell: function(spellName) {
                if (this.spells[spellName]) {
                    this.updateSpellDisplay();
                    effects.popup(`Learned ${this.spells[spellName].name}!`, 'achievement');
                }
            },

            // Method to update spell display
            updateSpellDisplay: function() {
                const container = document.getElementById('spellList');
                container.innerHTML = '';

                for (let spellKey in this.spells) {
                    const spell = this.spells[spellKey];
                    const spellElement = document.createElement('span');
                    spellElement.className = 'spell';
                    spellElement.onclick = () => castSpell(spellKey);

                    let emoji = 'üîÆ';
                    if (spellKey === 'fireball') emoji = 'üî•';
                    if (spellKey === 'heal') emoji = 'üíö';
                    if (spellKey === 'shield') emoji = 'üõ°Ô∏è';
                    if (spellKey === 'lightning') emoji = '‚ö°';

                    spellElement.innerHTML = `${emoji} ${spell.name}`;
                    container.appendChild(spellElement);
                }
            }
        };

        // Combat system object - demonstrates complex interactions
        const combat = {
            currentEnemy: null,
            isInCombat: false,

            // Method to start combat
            startCombat: function(enemy) {
                this.currentEnemy = { ...enemy }; // Create copy
                this.isInCombat = true;
                ui.updateStory(`A ${enemy.name} appears! It has ${enemy.health} health and looks dangerous. Choose your action wisely!`);

                ui.updateChoices(
                    '<button onclick="combat.playerAttack()">‚öîÔ∏è Attack with Weapon</button>' +
                    '<button onclick="combat.castOffensiveSpell()">üî• Cast Offensive Spell</button>' +
                    '<button onclick="combat.castDefensiveSpell()">üõ°Ô∏è Cast Defensive Spell</button>' +
                    '<button onclick="combat.attemptFlee()">üèÉ Attempt to Flee</button>'
                );
            },

            // Method for player weapon attack
            playerAttack: function() {
                if (!this.currentEnemy) return;

                const weaponDamage = character.equipment.weapon.attack;
                const totalDamage = weaponDamage + Math.floor(Math.random() * 10);

                this.currentEnemy.health -= totalDamage;
                effects.popup(`Dealt ${totalDamage} damage!`, 'achievement');

                if (this.currentEnemy.health <= 0) {
                    this.victory();
                } else {
                    this.enemyTurn();
                }
            },

            // Method for casting offensive spells
            castOffensiveSpell: function() {
                ui.updateStory(`Choose an offensive spell to cast:`);
                ui.updateChoices(
                    '<button onclick="combat.castSpecificSpell(\'fireball\')">üî• Fireball (15 MP)</button>' +
                    '<button onclick="combat.castSpecificSpell(\'lightning\')">‚ö° Lightning Bolt (30 MP)</button>' +
                    '<button onclick="combat.backToMainCombat()">üîô Back to Combat Menu</button>'
                );
            },

            // Method for casting defensive spells
            castDefensiveSpell: function() {
                ui.updateStory(`Choose a defensive action:`);
                ui.updateChoices(
                    '<button onclick="combat.castSpecificSpell(\'heal\')">üíö Heal (20 MP)</button>' +
                    '<button onclick="combat.castSpecificSpell(\'shield\')">üõ°Ô∏è Magic Shield (25 MP)</button>' +
                    '<button onclick="combat.backToMainCombat()">üîô Back to Combat Menu</button>'
                );
            },

            // Method to cast specific spell in combat
            castSpecificSpell: function(spellName) {
                const success = character.castSpell(spellName);

                if (success && this.currentEnemy) {
                    const spell = spellSystem.spells[spellName];

                    if (spell.damage) {
                        this.currentEnemy.health -= spell.damage;
                        if (this.currentEnemy.health <= 0) {
                            this.victory();
                            return;
                        }
                    }

                    this.enemyTurn();
                } else if (success) {
                    // Defensive spell cast successfully
                    this.backToMainCombat();
                }
            },

            // Method for enemy turn
            enemyTurn: function() {
                if (!this.currentEnemy) return;

                const damage = this.currentEnemy.attack - (character.shieldActive || 0);
                const actualDamage = Math.max(1, damage);

                character.modifyStats({ health: -actualDamage });

                ui.updateStory(`The ${this.currentEnemy.name} attacks for ${actualDamage} damage! ` +
                              `${character.shieldActive ? 'Your shield absorbed some damage!' : ''} ` +
                              `Your health: ${character.health}/${character.maxHealth}`);

                if (character.health <= 0) {
                    this.defeat();
                } else {
                    this.backToMainCombat();
                }
            },

            // Method to return to main combat menu
            backToMainCombat: function() {
                ui.updateStory(`Continue fighting the ${this.currentEnemy.name}! Health: ${this.currentEnemy.health}`);
                ui.updateChoices(
                    '<button onclick="combat.playerAttack()">‚öîÔ∏è Attack with Weapon</button>' +
                    '<button onclick="combat.castOffensiveSpell()">üî• Cast Offensive Spell</button>' +
                    '<button onclick="combat.castDefensiveSpell()">üõ°Ô∏è Cast Defensive Spell</button>' +
                    '<button onclick="combat.attemptFlee()">üèÉ Attempt to Flee</button>'
                );
            },

            // Method for fleeing
            attemptFlee: function() {
                if (Math.random() > 0.3) {
                    this.endCombat();
                    ui.updateStory("You successfully flee from combat!");
                    returnToForge();
                } else {
                    effects.popup("Can't escape!", 'damage');
                    this.enemyTurn();
                }
            },

            // Method for victory
            victory: function() {
                const goldReward = this.currentEnemy.goldReward || 0;
                const xpReward = this.currentEnemy.xpReward || 0;

                character.modifyStats({ gold: goldReward });
                character.gainExperience(xpReward);

                effects.popup(`Victory! +${goldReward} gold, +${xpReward} XP`, 'achievement');

                ui.updateStory(`You defeated the ${this.currentEnemy.name}! You gained ${goldReward} gold and ${xpReward} experience. Your mastery of combat magic grows stronger.`);

                this.endCombat();

                ui.updateChoices('<button onclick="returnToForge()">üîÆ Return to Spell Forge</button>');
            },

            // Method for defeat
            defeat: function() {
                ui.updateStory("You have been defeated! But your magical knowledge allows you to resurrect at the Spell Forge with half health.");
                character.health = Math.floor(character.maxHealth / 2);
                character.updateDisplay();
                this.endCombat();

                ui.updateChoices('<button onclick="returnToForge()">üîÆ Return to Spell Forge</button>');
            },

            // Method to end combat
            endCombat: function() {
                this.currentEnemy = null;
                this.isInCombat = false;
                character.shieldActive = 0;
            }
        };

        // Effects system object - demonstrates visual polish from slides
        const effects = {
            // Shake effect from slides
            shake: function(element) {
                element.classList.add('shake');
                setTimeout(() => element.classList.remove('shake'), 500);
            },

            // Popup notifications with different types
            popup: function(text, type = 'info') {
                const popup = document.createElement('div');
                popup.className = `popup ${type}`;
                popup.textContent = text;
                document.body.appendChild(popup);

                setTimeout(() => popup.remove(), 3000);
            },

            // Fade in animation
            fadeIn: function(element) {
                element.classList.add('fade-in');
                setTimeout(() => element.classList.remove('fade-in'), 500);
            },

            // Typewriter effect for dramatic moments
            typewrite: function(element, text, speed = 50) {
                element.innerHTML = '';
                let index = 0;

                const timer = setInterval(() => {
                    element.innerHTML += text[index];
                    index++;

                    if (index >= text.length) {
                        clearInterval(timer);
                    }
                }, speed);
            }
        };

        // UI system object - professional interface management
        const ui = {
            updateStory: function(newText) {
                const storyElement = document.getElementById('story');
                effects.fadeIn(storyElement);
                storyElement.innerHTML = newText;
            },

            updateChoices: function(choicesHtml) {
                const choicesElement = document.getElementById('choices');
                choicesElement.innerHTML = choicesHtml;
                effects.fadeIn(choicesElement);
            }
        };

        // Save system object - data persistence
        const saveSystem = {
            save: function() {
                const saveData = {
                    character: {
                        health: character.health,
                        mana: character.mana,
                        gold: character.gold,
                        level: character.level,
                        experience: character.experience
                    },
                    timestamp: Date.now()
                };
                localStorage.setItem('spellForgeSave', JSON.stringify(saveData));
                effects.popup('Progress saved!', 'achievement');
            },

            load: function() {
                const saved = localStorage.getItem('spellForgeSave');
                if (saved) {
                    const data = JSON.parse(saved);
                    Object.assign(character, data.character);
                    character.updateDisplay();
                    effects.popup('Progress loaded!', 'info');
                }
            }
        };

        // Trial functions - demonstrate different aspects of object-oriented programming
        function enterTrialOfCombat() {
            ui.updateStory(`You enter the Trial of Combat! Ancient magical guardians await to test your battle prowess. Defeat them using your weapon skills and spell casting abilities.`);

            const enemies = [
                { name: "Flame Guardian", health: 60, attack: 18, goldReward: 150, xpReward: 200 },
                { name: "Ice Sentinel", health: 80, attack: 22, goldReward: 200, xpReward: 250 },
                { name: "Storm Elemental", health: 100, attack: 25, goldReward: 300, xpReward: 350 }
            ];

            const choicesHtml = enemies.map((enemy, index) =>
                `<button onclick="combat.startCombat(${JSON.stringify(enemy).replace(/"/g, '&quot;')})">
                    ‚öîÔ∏è Fight ${enemy.name} (${enemy.health} HP)
                </button>`
            ).join('');

            ui.updateChoices(choicesHtml + '<button onclick="returnToForge()">üîÆ Return to Spell Forge</button>');
        }

        function enterTrialOfCrafting() {
            ui.updateStory(`You enter the Trial of Crafting! Here you can enhance your equipment, craft new spells, and improve your magical abilities using the forge's power.`);

            ui.updateChoices(
                '<button onclick="upgradeWeapon()">‚öîÔ∏è Upgrade Weapon (300g)</button>' +
                '<button onclick="enhanceArmor()">üõ°Ô∏è Enhance Armor (250g)</button>' +
                '<button onclick="craftLightningSpell()">‚ö° Craft Lightning Spell (400g)</button>' +
                '<button onclick="returnToForge()">üîÆ Return to Spell Forge</button>'
            );
        }

        function enterTrialOfWisdom() {
            ui.updateStory(`You enter the Trial of Wisdom! Test your knowledge of magic and demonstrate your understanding of spell combinations and magical theory.`);

            ui.updateChoices(
                '<button onclick="studyAdvancedMagic()">üìö Study Advanced Magic (+50 Max Mana)</button>' +
                '<button onclick="meditateForHealth()">üßò Meditate for Vitality (+30 Max Health)</button>' +
                '<button onclick="researchSpellEfficiency()">üî¨ Research Efficiency (Reduce Mana Costs)</button>' +
                '<button onclick="returnToForge()">üîÆ Return to Spell Forge</button>'
            );
        }

        function upgradeWeapon() {
            if (character.gold >= 300) {
                character.modifyStats({ gold: -300 });
                character.equipment.weapon.attack += 10;
                character.equipment.weapon.name = "Enhanced " + character.equipment.weapon.name;

                effects.shake(document.querySelector('.spells-panel'));
                ui.updateStory(`Your weapon glows with new power! Attack increased by 10. Your ${character.equipment.weapon.name} is now much more potent.`);

                ui.updateChoices('<button onclick="enterTrialOfCrafting()">üî® Continue Crafting</button>');
            } else {
                effects.popup('Not enough gold!', 'damage');
            }
        }

        function enhanceArmor() {
            if (character.gold >= 250) {
                character.modifyStats({ gold: -250 });
                character.equipment.armor.defense += 8;
                character.maxHealth += 25;
                character.health += 25;
                character.equipment.armor.name = "Reinforced " + character.equipment.armor.name;

                effects.shake(document.querySelector('.status-panel'));
                character.updateDisplay();
                ui.updateStory(`Your armor shimmers with protective enchantments! Defense increased and maximum health boosted. You feel much more resilient.`);

                ui.updateChoices('<button onclick="enterTrialOfCrafting()">üî® Continue Crafting</button>');
            } else {
                effects.popup('Not enough gold!', 'damage');
            }
        }

        function craftLightningSpell() {
            if (character.gold >= 400) {
                character.modifyStats({ gold: -400 });
                spellSystem.learnSpell('lightning');

                effects.shake(document.querySelector('.spells-panel'));
                ui.updateStory(`You successfully craft the Lightning Bolt spell! This powerful spell deals massive damage but costs more mana. The forge crackles with electrical energy as you master this advanced magic.`);

                ui.updateChoices('<button onclick="enterTrialOfCrafting()">üî® Continue Crafting</button>');
            } else {
                effects.popup('Not enough gold!', 'damage');
            }
        }

        function studyAdvancedMagic() {
            character.maxMana += 50;
            character.mana += 50;
            character.updateDisplay();
            character.gainExperience(300);

            effects.shake(document.querySelector('.status-panel'));
            ui.updateStory(`Your studies bear fruit! Your understanding of magical theory deepens, increasing your maximum mana by 50 points. Ancient knowledge flows through your mind.`);

            ui.updateChoices('<button onclick="enterTrialOfWisdom()">üìö Continue Studies</button>');
        }

        function meditateForHealth() {
            character.maxHealth += 30;
            character.health += 30;
            character.updateDisplay();
            character.gainExperience(250);

            effects.shake(document.querySelector('.status-panel'));
            ui.updateStory(`Through deep meditation, you strengthen your life force! Maximum health increased by 30. Your body feels more resilient and attuned to magical energies.`);

            ui.updateChoices('<button onclick="enterTrialOfWisdom()">üìö Continue Studies</button>');
        }

        function researchSpellEfficiency() {
            // Reduce all spell costs by 5
            for (let spellKey in spellSystem.spells) {
                spellSystem.spells[spellKey].manaCost = Math.max(5, spellSystem.spells[spellKey].manaCost - 5);
            }

            character.gainExperience(400);
            effects.shake(document.querySelector('.spells-panel'));
            ui.updateStory(`Your research into magical efficiency pays off! All spell mana costs are reduced by 5. You've learned to channel magic more effectively and with less waste.`);

            ui.updateChoices('<button onclick="enterTrialOfWisdom()">üìö Continue Studies</button>');
        }

        function castSpell(spellName) {
            if (combat.isInCombat) {
                combat.castSpecificSpell(spellName);
            } else {
                character.castSpell(spellName);
            }
        }

        function returnToForge() {
            ui.updateStory(`You return to the central chamber of the Spell Forge. The magical energy here continues to pulse with ancient power. Three trials await your mastery - combat, crafting, and wisdom. Each will test different aspects of your magical abilities and grant powerful rewards.`);

            ui.updateChoices(
                '<button onclick="enterTrialOfCombat()">‚öîÔ∏è Enter Trial of Combat</button>' +
                '<button onclick="enterTrialOfCrafting()">üî® Enter Trial of Crafting</button>' +
                '<button onclick="enterTrialOfWisdom()">üìö Enter Trial of Wisdom</button>' +
                '<button onclick="saveSystem.save()">üíæ Save Progress</button>'
            );
        }

        // Initialize the game
        function initializeGame() {
            character.updateDisplay();
            spellSystem.updateSpellDisplay();
            saveSystem.load();
        }

        // Start the game when page loads
        window.addEventListener('DOMContentLoaded', initializeGame);
    </script>
</body>
</html>